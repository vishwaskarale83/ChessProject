<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CheckMateIQ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4ecf7 100%);
            margin: 0;
            padding: 30px 16px 60px;
            color: #1f2d3d;
        }
        .container {
            max-width: 1080px;
            margin: 0 auto;
        }
        .hero {
            text-align: center;
            margin-bottom: 32px;
        }
        .hero h1 {
            margin: 0;
            font-size: 2.4rem;
            color: #1f2d3d;
        }
        .hero p {
            margin-top: 8px;
            color: #5c6c7c;
        }
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .option-card {
            background: #fff;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 12px 30px rgba(31, 45, 61, 0.12);
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .option-card h3 {
            margin: 0;
            font-size: 1.25rem;
            color: #1f2d3d;
        }
        .option-card p {
            margin: 0;
            color: #5c6c7c;
            line-height: 1.5;
        }
        .option-card form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        label {
            font-weight: 600;
            color: #33475b;
        }
        select {
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #c9d6e2;
            font-size: 0.95rem;
            color: #1f2d3d;
            background: #f9fbfd;
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 18px;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease;
            border: none;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(17, 24, 39, 0.12);
        }
        .btn-primary {
            background: #1f78ff;
            color: #fff;
        }
        .btn-success {
            background: #22a06b;
            color: #fff;
        }
        .btn-secondary {
            background: #6f42c1;
            color: #fff;
        }
        .btn-outline {
            background: transparent;
            color: #1f78ff;
            border: 1px solid rgba(31, 120, 255, 0.4);
        }
        .link-button {
            color: #1f78ff;
            font-weight: 600;
            text-decoration: none;
        }
        .link-button:hover {
            text-decoration: underline;
        }
        .section-block {
            margin-bottom: 40px;
        }
        .section-header {
            margin-bottom: 16px;
        }
        .section-header h3 {
            margin: 0;
            font-size: 1.4rem;
            color: #1f2d3d;
        }
        .section-header p {
            margin: 6px 0 0;
            color: #5c6c7c;
        }
        .cards-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .cards-list.latest-first {
            flex-direction: column-reverse;
        }
        .game-card {
            background: #fff;
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 8px 24px rgba(31, 45, 61, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }
        .game-meta {
            color: #33475b;
            line-height: 1.4;
        }
        .game-meta strong {
            color: #1f2d3d;
        }
        .empty-state {
            background: rgba(31, 120, 255, 0.08);
            border: 1px dashed rgba(31, 120, 255, 0.3);
            border-radius: 12px;
            padding: 18px;
            text-align: center;
            color: #4b6176;
            font-style: italic;
        }
        .inline-form {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .page-footer {
            text-align: center;
            margin-top: 48px;
            color: #5c6c7c;
        }
        .page-footer a {
            color: #1f78ff;
            font-weight: 600;
            text-decoration: none;
        }
        .page-footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <h1 th:text="${'Welcome  to CheckMate IQ ' + (#authentication != null and !#authentication.principal.equals('anonymousUser') ? #authentication.name : '')}"></h1>
            <p>Choose how you want to play today.</p>
        </div>

        <div class="options-grid">
            <div class="option-card">
                <h3>Play the Computer</h3>
                <p>Practice openings, tactics, or just unwind against our built‑in AI opponent.</p>
                <form th:action="@{/games/create}" method="post">
                    <input type="hidden" name="mode" value="AI">
                    <label for="ai-player-color">Choose your color</label>
                    <select id="ai-player-color" name="playerColor">
                        <option value="WHITE" selected>White</option>
                        <option value="BLACK">Black</option>
                    </select>
                    <button type="submit" class="btn btn-success">Start AI Game</button>
                </form>
            </div>

            <div class="option-card">
                <h3>Play Online</h3>
                <p>Create a game and share the link, or browse open games and hop right in.</p>
                <form th:action="@{/games/create}" method="post">
                    <input type="hidden" name="mode" value="HUMAN">
                    <label for="time-control">Time control</label>
                    <select id="time-control" name="timeControl">
                        <option value="NONE" selected>No time limit</option>
                        <option value="180">3 minutes</option>
                        <option value="300">5 minutes</option>
                        <option value="600">10 minutes</option>
                    </select>
                    <button type="submit" class="btn btn-primary">Start New Game</button>
                </form>
                <a href="#available-games" class="link-button">See available games →</a>
            </div>

            <div class="option-card">
                <h3>Puzzles</h3>
                <p>Sharpen your tactical awareness with curated chess puzzles of every difficulty.</p>
                <a href="/puzzles" class="btn btn-secondary">Solve Puzzles</a>
            </div>
        </div>

        <section id="available-games" class="section-block">
            <div class="section-header">
                <h3>Available Online Games</h3>
                <p>Join another player who is ready to battle.</p>
            </div>
            <div th:if="${#lists.isEmpty(availableGames)}" class="empty-state">
                No games are waiting right now. Start a game and invite a friend!
            </div>
            <div th:unless="${#lists.isEmpty(availableGames)}" class="cards-list">
                <div class="game-card" th:each="game : ${availableGames}"
                     th:with="isAiGame=${game.gameType == T(com.example.chess.GameType).HUMAN_VS_AI},
                              humanAiColor=${isAiGame ? (game.playerColor != null ? game.playerColor : T(com.example.chess.Color).WHITE) : null},
                              aiColor=${isAiGame ? (humanAiColor == T(com.example.chess.Color).WHITE ? T(com.example.chess.Color).BLACK : T(com.example.chess.Color).WHITE) : null},
                                  whiteDisplay=${game.whitePlayer != null ? game.whitePlayer.username + ' (White)' : (isAiGame && aiColor == T(com.example.chess.Color).WHITE ? 'AI (White)' : 'Waiting for opponent (White)')},
                                  blackDisplay=${game.blackPlayer != null ? game.blackPlayer.username + ' (Black)' : (isAiGame && aiColor == T(com.example.chess.Color).BLACK ? 'AI (Black)' : 'Waiting for opponent (Black)')},
                              hostLabel=${game.whitePlayer != null ? game.whitePlayer.username + ' (White)' : (game.blackPlayer != null ? game.blackPlayer.username + ' (Black)' : (isAiGame ? 'AI' : 'Awaiting host'))}">
                    <div class="game-meta">
                        <strong>Game <span th:text="${game.gameUuid}"></span></strong><br>
                        Host: <span th:text="${hostLabel}"></span><br>
                        <span th:text="${whiteDisplay}"></span>
                        vs
                        <span th:text="${blackDisplay}"></span>
                        <div>Status: Waiting for opponent</div>
                        <span th:if="${game.initialTimeSeconds != null}"><br>Time: <span th:text="${game.initialTimeSeconds / 60}"></span> min</span>
                    </div>
                    <form class="inline-form" th:action="@{'/games/' + ${game.gameUuid} + '/join'}" method="post">
                        <button type="submit" class="btn btn-primary">Join Game</button>
                    </form>
                </div>
            </div>
        </section>

        <section id="your-games" class="section-block">
            <div class="section-header">
                <h3>Your Games</h3>
                <p>Resume active matches and review how your finished games concluded.</p>
            </div>
            <div th:if="${#lists.isEmpty(userGames)}" class="empty-state">
                You haven't joined any games yet. Start one above to get going!
            </div>
                <div th:unless="${#lists.isEmpty(userGames)}" class="cards-list latest-first">
                                 <div class="game-card"
                                     th:each="game : ${userGames}"
                                                      th:with="currentUserName=${#authentication != null ? #authentication.name : null},
                                                                         isWhite=${currentUserName != null and game.whitePlayer != null and game.whitePlayer.username == currentUserName},
                                                                         isBlack=${currentUserName != null and game.blackPlayer != null and game.blackPlayer.username == currentUserName},
                                                                         playerColor=${isWhite ? 'WHITE' : (isBlack ? 'BLACK' : null)},
                                                                         isDrawOutcome=${game.result == T(com.example.chess.GameOutcome).DRAW or game.endType == T(com.example.chess.GameEndType).AGREED_DRAW or game.endType == T(com.example.chess.GameEndType).STALEMATE},
                                                                         hasWinner=${game.result == T(com.example.chess.GameOutcome).WHITE_WIN or game.result == T(com.example.chess.GameOutcome).BLACK_WIN},
                                                                         winnerColor=${hasWinner ? (game.result == T(com.example.chess.GameOutcome).WHITE_WIN ? 'WHITE' : 'BLACK') : null},
                                                                         statusLabel=${game.status == T(com.example.chess.GameStatus).FINISHED ? (isDrawOutcome ? 'Draw' : (hasWinner ? (playerColor != null ? (playerColor == winnerColor ? 'Won' : 'Lost') : (winnerColor == 'WHITE' ? 'White won' : 'Black won')) : 'Finished')) : (game.status == T(com.example.chess.GameStatus).ACTIVE ? 'In Progress' : 'Waiting')},
                                                                         reasonLabel=${game.status == T(com.example.chess.GameStatus).FINISHED ? (game.endType == null ? null : (game.endType == T(com.example.chess.GameEndType).CHECKMATE ? 'Checkmate' : (game.endType == T(com.example.chess.GameEndType).STALEMATE ? 'Stalemate' : (game.endType == T(com.example.chess.GameEndType).RESIGNATION ? 'Resignation' : (game.endType == T(com.example.chess.GameEndType).TIMEOUT ? 'Timeout' : (game.endType == T(com.example.chess.GameEndType).KING_CAPTURE ? 'King Capture' : (game.endType == T(com.example.chess.GameEndType).AGREED_DRAW ? 'Agreed Draw' : null))))))) : null},
                                                                         isAiGame=${game.gameType == T(com.example.chess.GameType).HUMAN_VS_AI},
                                                                         humanAiColor=${isAiGame ? (game.playerColor != null ? game.playerColor : T(com.example.chess.Color).WHITE) : null},
                                                                         aiColor=${isAiGame ? (humanAiColor == T(com.example.chess.Color).WHITE ? T(com.example.chess.Color).BLACK : T(com.example.chess.Color).WHITE) : null},
                                                                             whiteDisplay=${game.whitePlayer != null ? game.whitePlayer.username + ' (White)' : (isAiGame && aiColor == T(com.example.chess.Color).WHITE ? 'AI (White)' : 'Waiting for opponent (White)')},
                                                                             blackDisplay=${game.blackPlayer != null ? game.blackPlayer.username + ' (Black)' : (isAiGame && aiColor == T(com.example.chess.Color).BLACK ? 'AI (Black)' : 'Waiting for opponent (Black)')}">
                    <div class="game-meta">
                        <strong th:text="${game.gameName != null ? game.gameName : 'Chess Game'}"></strong><br>
                                <span th:text="${whiteDisplay}"></span>
                        vs
                                <span th:text="${blackDisplay}"></span>
                        <br>Status: <strong th:text="${statusLabel}"></strong>
                        <span th:if="${reasonLabel != null}"> (<span th:text="${reasonLabel}"></span>)</span>
                        <span th:if="${game.initialTimeSeconds != null}"><br>Time: <span th:text="${game.initialTimeSeconds / 60}"></span> min</span>
                    </div>
                    <div class="inline-form">
                        <a th:href="@{'/game/' + ${game.gameUuid}}" class="btn btn-primary">Open</a>
                    </div>
                </div>
            </div>
        </section>

        <div class="page-footer">
            Ready for a break? <a href="/logout">Log out</a>
        </div>
    </div>
</body>
</html>